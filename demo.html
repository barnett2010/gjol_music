<html>

<head>
    <title>在线转换</title>
    <link rel="stylesheet" href="./demo/style.css"/>

    <style>
        textarea {
            width: 80%;
            height: 500px;
            border: 1px solid green;
        }
    </style>

    <script type="text/javascript" src="./demo/translator.js"></script>

    <script type="text/javascript">
        function openMusicXML(e) {
            if (window.FileReader) {
                var reader = new FileReader();
                reader.onload = function () {
                    var data = reader.result;
                    if (data)
                        document.getElementById('source').value = data;
                };
                reader.onerror = function () {
                    alert(reader.error.message);
                };

                var input = e.target;
                var file = input.files[ 0 ];
                var name = file.name;
                reader.readAsText(file);
            } else {
                alert('你的浏览器太落后了,请自行将MusicXML的内容粘贴到源');
            }
        }

        function doTranslate() {
            var data = document.getElementById('source').value;

            var translator = new Translator(data);
            var result = translator.translate();
            document.getElementById('target').value = result || '';
        }

        function doSaveAs() {
            var anchor = document.getElementById('anchor');
            var val = document.getElementById('target').value;
            var blob = new Blob([ val ], { type : 'text/plain' });
            anchor.download = 'html.gjm';
            anchor.href = (window.webkitURL || window.URL).createObjectURL(blob);
            anchor.dataset.downloadurl = [ 'text/plain', anchor.download, anchor.href ].join(':');
        }
    </script>
</head>

<body>
<h1>MusicXML -> GJM</h1>
<input type="file" accept="application/vnd.recordare.musicxml+xml" onchange="openMusicXML(event);" value="选择MusicXML..."><br>
<span>MusicXML:</span><br>
<textarea id="source" title="MusicXML">

</textarea>
<br>
<input type="button" value="转化..." onclick="doTranslate();">&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" onclick="doSaveAs();" id="anchor">下载...</a>
<br>
<textarea id="target" title="GJM" disabled="disabled"></textarea>
</body>

</html>
